<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Resilience with Polly - BlackSlope.NET</title>
    <meta name="description" content="Documentation for BlackSlope.NET - A .NET Reference Architecture">
    <meta name="generator" content="VitePress v1.6.4">
    <link rel="preload stylesheet" href="/assets/style.C2c9dqG-.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    
    <script type="module" src="/assets/app.CIRqPOt7.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/theme.QfrPoxYX.js">
    <link rel="modulepreload" href="/assets/chunks/framework.Cycwnjj0.js">
    <link rel="modulepreload" href="/assets/features_resilience.md.DkWVoTdz.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-08477083><!--[--><!--]--><!--[--><span tabindex="-1" data-v-561df0f5></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-561df0f5>Skip to content</a><!--]--><!----><header class="VPNav" data-v-08477083 data-v-1e79cb7b><div class="VPNavBar" data-v-1e79cb7b data-v-829ec1cc><div class="wrapper" data-v-829ec1cc><div class="container" data-v-829ec1cc><div class="title" data-v-829ec1cc><div class="VPNavBarTitle has-sidebar" data-v-829ec1cc data-v-c6af45db><a class="title" href="/" data-v-c6af45db><!--[--><!--]--><!----><span data-v-c6af45db>BlackSlope.NET Documentation</span><!--[--><!--]--></a></div></div><div class="content" data-v-829ec1cc><div class="content-body" data-v-829ec1cc><!--[--><!--]--><div class="VPNavBarSearch search" data-v-829ec1cc><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-829ec1cc data-v-675103d6><span id="main-nav-aria-label" class="visually-hidden" data-v-675103d6> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/" tabindex="0" data-v-675103d6 data-v-78089080><!--[--><span data-v-78089080>Home</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/getting_started/introduction.html" tabindex="0" data-v-675103d6 data-v-78089080><!--[--><span data-v-78089080>Getting Started</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/architecture/overview.html" tabindex="0" data-v-675103d6 data-v-78089080><!--[--><span data-v-78089080>Architecture</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/api_reference/health_api.html" tabindex="0" data-v-675103d6 data-v-78089080><!--[--><span data-v-78089080>API Reference</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-829ec1cc data-v-94105794><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-94105794 data-v-923d509b data-v-6a33eae6><span class="check" data-v-6a33eae6><span class="icon" data-v-6a33eae6><!--[--><span class="vpi-sun sun" data-v-923d509b></span><span class="vpi-moon moon" data-v-923d509b></span><!--]--></span></span></button></div><!----><div class="VPFlyout VPNavBarExtra extra" data-v-829ec1cc data-v-4e81c3af data-v-8b7536da><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-8b7536da><span class="vpi-more-horizontal icon" data-v-8b7536da></span></button><div class="menu" data-v-8b7536da><div class="VPMenu" data-v-8b7536da data-v-abcd843a><!----><!--[--><!--[--><!----><div class="group" data-v-4e81c3af><div class="item appearance" data-v-4e81c3af><p class="label" data-v-4e81c3af>Appearance</p><div class="appearance-action" data-v-4e81c3af><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-4e81c3af data-v-923d509b data-v-6a33eae6><span class="check" data-v-6a33eae6><span class="icon" data-v-6a33eae6><!--[--><span class="vpi-sun sun" data-v-923d509b></span><span class="vpi-moon moon" data-v-923d509b></span><!--]--></span></span></button></div></div></div><!----><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-829ec1cc data-v-19384ef9><span class="container" data-v-19384ef9><span class="top" data-v-19384ef9></span><span class="middle" data-v-19384ef9></span><span class="bottom" data-v-19384ef9></span></span></button></div></div></div></div><div class="divider" data-v-829ec1cc><div class="divider-line" data-v-829ec1cc></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-08477083 data-v-46e39d9a><div class="container" data-v-46e39d9a><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-46e39d9a><span class="vpi-align-left menu-icon" data-v-46e39d9a></span><span class="menu-text" data-v-46e39d9a>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-46e39d9a data-v-4d97def9><button data-v-4d97def9>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-08477083 data-v-849b6984><div class="curtain" data-v-849b6984></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-849b6984><span class="visually-hidden" id="sidebar-aria-label" data-v-849b6984> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-79a6a4dd><section class="VPSidebarItem level-0" data-v-79a6a4dd data-v-7743fcc0><div class="item" role="button" tabindex="0" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><h2 class="text" data-v-7743fcc0>Getting Started</h2><!----></div><div class="items" data-v-7743fcc0><!--[--><div class="VPSidebarItem level-1 is-link" data-v-7743fcc0 data-v-7743fcc0><div class="item" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><a class="VPLink link link" href="/getting_started/introduction.html" data-v-7743fcc0><!--[--><p class="text" data-v-7743fcc0>Introduction</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-7743fcc0 data-v-7743fcc0><div class="item" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><a class="VPLink link link" href="/getting_started/prerequisites.html" data-v-7743fcc0><!--[--><p class="text" data-v-7743fcc0>Prerequisites</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-7743fcc0 data-v-7743fcc0><div class="item" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><a class="VPLink link link" href="/getting_started/installation.html" data-v-7743fcc0><!--[--><p class="text" data-v-7743fcc0>Installation</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-7743fcc0 data-v-7743fcc0><div class="item" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><a class="VPLink link link" href="/getting_started/quick_start.html" data-v-7743fcc0><!--[--><p class="text" data-v-7743fcc0>Quick Start</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-79a6a4dd><section class="VPSidebarItem level-0" data-v-79a6a4dd data-v-7743fcc0><div class="item" role="button" tabindex="0" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><h2 class="text" data-v-7743fcc0>Architecture</h2><!----></div><div class="items" data-v-7743fcc0><!--[--><div class="VPSidebarItem level-1 is-link" data-v-7743fcc0 data-v-7743fcc0><div class="item" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><a class="VPLink link link" href="/architecture/overview.html" data-v-7743fcc0><!--[--><p class="text" data-v-7743fcc0>Overview</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-7743fcc0 data-v-7743fcc0><div class="item" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><a class="VPLink link link" href="/architecture/project_structure.html" data-v-7743fcc0><!--[--><p class="text" data-v-7743fcc0>Project Structure</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-7743fcc0 data-v-7743fcc0><div class="item" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><a class="VPLink link link" href="/architecture/layers.html" data-v-7743fcc0><!--[--><p class="text" data-v-7743fcc0>Layers</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-7743fcc0 data-v-7743fcc0><div class="item" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><a class="VPLink link link" href="/architecture/dependency_injection.html" data-v-7743fcc0><!--[--><p class="text" data-v-7743fcc0>Dependency Injection</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-7743fcc0 data-v-7743fcc0><div class="item" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><a class="VPLink link link" href="/architecture/middleware_pipeline.html" data-v-7743fcc0><!--[--><p class="text" data-v-7743fcc0>Middleware Pipeline</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-79a6a4dd><section class="VPSidebarItem level-0 has-active" data-v-79a6a4dd data-v-7743fcc0><div class="item" role="button" tabindex="0" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><h2 class="text" data-v-7743fcc0>Features</h2><!----></div><div class="items" data-v-7743fcc0><!--[--><div class="VPSidebarItem level-1 is-link" data-v-7743fcc0 data-v-7743fcc0><div class="item" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><a class="VPLink link link" href="/features/controllers.html" data-v-7743fcc0><!--[--><p class="text" data-v-7743fcc0>Controllers</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-7743fcc0 data-v-7743fcc0><div class="item" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><a class="VPLink link link" href="/features/services.html" data-v-7743fcc0><!--[--><p class="text" data-v-7743fcc0>Services</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-7743fcc0 data-v-7743fcc0><div class="item" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><a class="VPLink link link" href="/features/repositories.html" data-v-7743fcc0><!--[--><p class="text" data-v-7743fcc0>Repositories</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-7743fcc0 data-v-7743fcc0><div class="item" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><a class="VPLink link link" href="/features/automapper.html" data-v-7743fcc0><!--[--><p class="text" data-v-7743fcc0>AutoMapper</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-7743fcc0 data-v-7743fcc0><div class="item" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><a class="VPLink link link" href="/features/validation.html" data-v-7743fcc0><!--[--><p class="text" data-v-7743fcc0>Validation</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-7743fcc0 data-v-7743fcc0><div class="item" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><a class="VPLink link link" href="/features/exception_handling.html" data-v-7743fcc0><!--[--><p class="text" data-v-7743fcc0>Exception Handling</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-7743fcc0 data-v-7743fcc0><div class="item" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><a class="VPLink link link" href="/features/health_checks.html" data-v-7743fcc0><!--[--><p class="text" data-v-7743fcc0>Health Checks</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-7743fcc0 data-v-7743fcc0><div class="item" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><a class="VPLink link link" href="/features/swagger_integration.html" data-v-7743fcc0><!--[--><p class="text" data-v-7743fcc0>Swagger Integration</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-7743fcc0 data-v-7743fcc0><div class="item" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><a class="VPLink link link" href="/features/versioning.html" data-v-7743fcc0><!--[--><p class="text" data-v-7743fcc0>Versioning</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-7743fcc0 data-v-7743fcc0><div class="item" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><a class="VPLink link link" href="/features/correlation_id.html" data-v-7743fcc0><!--[--><p class="text" data-v-7743fcc0>Correlation ID</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-7743fcc0 data-v-7743fcc0><div class="item" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><a class="VPLink link link" href="/features/resilience.html" data-v-7743fcc0><!--[--><p class="text" data-v-7743fcc0>Resilience (Polly)</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-7743fcc0 data-v-7743fcc0><div class="item" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><a class="VPLink link link" href="/features/http_client.html" data-v-7743fcc0><!--[--><p class="text" data-v-7743fcc0>HTTP Client</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-79a6a4dd><section class="VPSidebarItem level-0" data-v-79a6a4dd data-v-7743fcc0><div class="item" role="button" tabindex="0" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><h2 class="text" data-v-7743fcc0>Database</h2><!----></div><div class="items" data-v-7743fcc0><!--[--><div class="VPSidebarItem level-1 is-link" data-v-7743fcc0 data-v-7743fcc0><div class="item" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><a class="VPLink link link" href="/database/entity_framework.html" data-v-7743fcc0><!--[--><p class="text" data-v-7743fcc0>Entity Framework</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-7743fcc0 data-v-7743fcc0><div class="item" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><a class="VPLink link link" href="/database/migrations.html" data-v-7743fcc0><!--[--><p class="text" data-v-7743fcc0>Migrations</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-7743fcc0 data-v-7743fcc0><div class="item" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><a class="VPLink link link" href="/database/repository_configuration.html" data-v-7743fcc0><!--[--><p class="text" data-v-7743fcc0>Repository Configuration</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-7743fcc0 data-v-7743fcc0><div class="item" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><a class="VPLink link link" href="/database/seeding_data.html" data-v-7743fcc0><!--[--><p class="text" data-v-7743fcc0>Seeding Data</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-79a6a4dd><section class="VPSidebarItem level-0" data-v-79a6a4dd data-v-7743fcc0><div class="item" role="button" tabindex="0" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><h2 class="text" data-v-7743fcc0>Configuration</h2><!----></div><div class="items" data-v-7743fcc0><!--[--><div class="VPSidebarItem level-1 is-link" data-v-7743fcc0 data-v-7743fcc0><div class="item" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><a class="VPLink link link" href="/configuration/application_settings.html" data-v-7743fcc0><!--[--><p class="text" data-v-7743fcc0>Application Settings</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-7743fcc0 data-v-7743fcc0><div class="item" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><a class="VPLink link link" href="/configuration/service_configuration.html" data-v-7743fcc0><!--[--><p class="text" data-v-7743fcc0>Service Configuration</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-7743fcc0 data-v-7743fcc0><div class="item" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><a class="VPLink link link" href="/configuration/logging.html" data-v-7743fcc0><!--[--><p class="text" data-v-7743fcc0>Logging</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-79a6a4dd><section class="VPSidebarItem level-0" data-v-79a6a4dd data-v-7743fcc0><div class="item" role="button" tabindex="0" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><h2 class="text" data-v-7743fcc0>Security</h2><!----></div><div class="items" data-v-7743fcc0><!--[--><div class="VPSidebarItem level-1 is-link" data-v-7743fcc0 data-v-7743fcc0><div class="item" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><a class="VPLink link link" href="/security/authentication.html" data-v-7743fcc0><!--[--><p class="text" data-v-7743fcc0>Authentication</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-7743fcc0 data-v-7743fcc0><div class="item" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><a class="VPLink link link" href="/security/authorization.html" data-v-7743fcc0><!--[--><p class="text" data-v-7743fcc0>Authorization</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-7743fcc0 data-v-7743fcc0><div class="item" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><a class="VPLink link link" href="/security/cors.html" data-v-7743fcc0><!--[--><p class="text" data-v-7743fcc0>CORS</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-7743fcc0 data-v-7743fcc0><div class="item" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><a class="VPLink link link" href="/security/best_practices.html" data-v-7743fcc0><!--[--><p class="text" data-v-7743fcc0>Best Practices</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-79a6a4dd><section class="VPSidebarItem level-0" data-v-79a6a4dd data-v-7743fcc0><div class="item" role="button" tabindex="0" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><h2 class="text" data-v-7743fcc0>API Reference</h2><!----></div><div class="items" data-v-7743fcc0><!--[--><div class="VPSidebarItem level-1 is-link" data-v-7743fcc0 data-v-7743fcc0><div class="item" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><a class="VPLink link link" href="/api_reference/movies_api.html" data-v-7743fcc0><!--[--><p class="text" data-v-7743fcc0>Movies API</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-7743fcc0 data-v-7743fcc0><div class="item" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><a class="VPLink link link" href="/api_reference/health_api.html" data-v-7743fcc0><!--[--><p class="text" data-v-7743fcc0>Health API</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-7743fcc0 data-v-7743fcc0><div class="item" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><a class="VPLink link link" href="/api_reference/version_api.html" data-v-7743fcc0><!--[--><p class="text" data-v-7743fcc0>Version API</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-7743fcc0 data-v-7743fcc0><div class="item" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><a class="VPLink link link" href="/api_reference/error_responses.html" data-v-7743fcc0><!--[--><p class="text" data-v-7743fcc0>Error Responses</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-79a6a4dd><section class="VPSidebarItem level-0" data-v-79a6a4dd data-v-7743fcc0><div class="item" role="button" tabindex="0" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><h2 class="text" data-v-7743fcc0>Testing</h2><!----></div><div class="items" data-v-7743fcc0><!--[--><div class="VPSidebarItem level-1 is-link" data-v-7743fcc0 data-v-7743fcc0><div class="item" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><a class="VPLink link link" href="/testing/overview.html" data-v-7743fcc0><!--[--><p class="text" data-v-7743fcc0>Overview</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-7743fcc0 data-v-7743fcc0><div class="item" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><a class="VPLink link link" href="/testing/unit_tests.html" data-v-7743fcc0><!--[--><p class="text" data-v-7743fcc0>Unit Tests</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-7743fcc0 data-v-7743fcc0><div class="item" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><a class="VPLink link link" href="/testing/integration_tests.html" data-v-7743fcc0><!--[--><p class="text" data-v-7743fcc0>Integration Tests</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-7743fcc0 data-v-7743fcc0><div class="item" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><a class="VPLink link link" href="/testing/bdd_tests.html" data-v-7743fcc0><!--[--><p class="text" data-v-7743fcc0>BDD Tests</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-7743fcc0 data-v-7743fcc0><div class="item" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><a class="VPLink link link" href="/testing/test_utilities.html" data-v-7743fcc0><!--[--><p class="text" data-v-7743fcc0>Test Utilities</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-79a6a4dd><section class="VPSidebarItem level-0" data-v-79a6a4dd data-v-7743fcc0><div class="item" role="button" tabindex="0" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><h2 class="text" data-v-7743fcc0>Development</h2><!----></div><div class="items" data-v-7743fcc0><!--[--><div class="VPSidebarItem level-1 is-link" data-v-7743fcc0 data-v-7743fcc0><div class="item" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><a class="VPLink link link" href="/development/environment.html" data-v-7743fcc0><!--[--><p class="text" data-v-7743fcc0>Environment Setup</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-7743fcc0 data-v-7743fcc0><div class="item" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><a class="VPLink link link" href="/development/build_scripts.html" data-v-7743fcc0><!--[--><p class="text" data-v-7743fcc0>Build Scripts</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-7743fcc0 data-v-7743fcc0><div class="item" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><a class="VPLink link link" href="/development/code_quality.html" data-v-7743fcc0><!--[--><p class="text" data-v-7743fcc0>Code Quality</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-7743fcc0 data-v-7743fcc0><div class="item" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><a class="VPLink link link" href="/development/utilities.html" data-v-7743fcc0><!--[--><p class="text" data-v-7743fcc0>Utilities</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-7743fcc0 data-v-7743fcc0><div class="item" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><a class="VPLink link link" href="/development/contributing.html" data-v-7743fcc0><!--[--><p class="text" data-v-7743fcc0>Contributing</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-79a6a4dd><section class="VPSidebarItem level-0" data-v-79a6a4dd data-v-7743fcc0><div class="item" role="button" tabindex="0" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><h2 class="text" data-v-7743fcc0>Deployment</h2><!----></div><div class="items" data-v-7743fcc0><!--[--><div class="VPSidebarItem level-1 is-link" data-v-7743fcc0 data-v-7743fcc0><div class="item" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><a class="VPLink link link" href="/deployment/docker.html" data-v-7743fcc0><!--[--><p class="text" data-v-7743fcc0>Docker</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-7743fcc0 data-v-7743fcc0><div class="item" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><a class="VPLink link link" href="/deployment/kubernetes.html" data-v-7743fcc0><!--[--><p class="text" data-v-7743fcc0>Kubernetes</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-7743fcc0 data-v-7743fcc0><div class="item" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><a class="VPLink link link" href="/deployment/monitoring.html" data-v-7743fcc0><!--[--><p class="text" data-v-7743fcc0>Monitoring</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-7743fcc0 data-v-7743fcc0><div class="item" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><a class="VPLink link link" href="/deployment/versioning_strategy.html" data-v-7743fcc0><!--[--><p class="text" data-v-7743fcc0>Versioning Strategy</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-7743fcc0 data-v-7743fcc0><div class="item" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><a class="VPLink link link" href="/deployment/production_best_practices.html" data-v-7743fcc0><!--[--><p class="text" data-v-7743fcc0>Production Best Practices</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-79a6a4dd><section class="VPSidebarItem level-0" data-v-79a6a4dd data-v-7743fcc0><div class="item" role="button" tabindex="0" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><h2 class="text" data-v-7743fcc0>Troubleshooting</h2><!----></div><div class="items" data-v-7743fcc0><!--[--><div class="VPSidebarItem level-1 is-link" data-v-7743fcc0 data-v-7743fcc0><div class="item" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><a class="VPLink link link" href="/troubleshooting/common_issues.html" data-v-7743fcc0><!--[--><p class="text" data-v-7743fcc0>Common Issues</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-7743fcc0 data-v-7743fcc0><div class="item" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><a class="VPLink link link" href="/troubleshooting/debugging.html" data-v-7743fcc0><!--[--><p class="text" data-v-7743fcc0>Debugging</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-7743fcc0 data-v-7743fcc0><div class="item" data-v-7743fcc0><div class="indicator" data-v-7743fcc0></div><a class="VPLink link link" href="/troubleshooting/faq.html" data-v-7743fcc0><!--[--><p class="text" data-v-7743fcc0>FAQ</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-08477083 data-v-f34ea512><div class="VPDoc has-sidebar has-aside" data-v-f34ea512 data-v-2e62732c><!--[--><!--]--><div class="container" data-v-2e62732c><div class="aside" data-v-2e62732c><div class="aside-curtain" data-v-2e62732c></div><div class="aside-container" data-v-2e62732c><div class="aside-content" data-v-2e62732c><div class="VPDocAside" data-v-2e62732c data-v-cdbf007b><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-cdbf007b data-v-4d4d3658><div class="content" data-v-4d4d3658><div class="outline-marker" data-v-4d4d3658></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-4d4d3658>Contents</div><ul class="VPDocOutlineItem root" data-v-4d4d3658 data-v-ca19feda><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-cdbf007b></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-2e62732c><div class="content-container" data-v-2e62732c><!--[--><!--]--><main class="main" data-v-2e62732c><div style="position:relative;" class="vp-doc _features_resilience external-link-icon-enabled" data-v-2e62732c><div><h1 id="resilience-with-polly" tabindex="-1">Resilience with Polly <a class="header-anchor" href="#resilience-with-polly" aria-label="Permalink to &quot;Resilience with Polly&quot;">​</a></h1><h2 id="polly-overview" tabindex="-1">Polly Overview <a class="header-anchor" href="#polly-overview" aria-label="Permalink to &quot;Polly Overview&quot;">​</a></h2><p>Polly is a .NET resilience and transient-fault-handling library that enables developers to express policies such as Retry, Circuit Breaker, Timeout, Bulkhead Isolation, and Fallback in a fluent and thread-safe manner. In the BlackSlope.Api application, Polly is integrated with the <code>HttpClient</code> infrastructure to provide robust handling of transient failures when making outbound HTTP requests.</p><h3 id="transient-fault-handling" tabindex="-1">Transient Fault Handling <a class="header-anchor" href="#transient-fault-handling" aria-label="Permalink to &quot;Transient Fault Handling&quot;">​</a></h3><p>Transient faults are temporary errors that often resolve themselves if the operation is retried. Common examples include:</p><ul><li><strong>Network connectivity issues</strong>: Brief network interruptions or DNS resolution failures</li><li><strong>Service unavailability</strong>: Temporary overload or restart of downstream services</li><li><strong>Timeout errors</strong>: Requests that exceed time limits due to temporary resource constraints</li><li><strong>HTTP 5xx errors</strong>: Server-side errors that may be resolved on retry</li><li><strong>HTTP 429 (Too Many Requests)</strong>: Rate limiting that may clear after a brief delay</li></ul><p>The BlackSlope.Api application uses Polly to automatically handle these scenarios without requiring manual retry logic in business code.</p><h3 id="resilience-strategies" tabindex="-1">Resilience Strategies <a class="header-anchor" href="#resilience-strategies" aria-label="Permalink to &quot;Resilience Strategies&quot;">​</a></h3><p>Polly provides several resilience strategies that can be combined to create sophisticated fault-handling behaviors:</p><table tabindex="0"><thead><tr><th>Strategy</th><th>Purpose</th><th>Use Case</th></tr></thead><tbody><tr><td><strong>Retry</strong></td><td>Automatically retry failed operations</td><td>Handle transient network failures</td></tr><tr><td><strong>Circuit Breaker</strong></td><td>Prevent cascading failures by stopping requests to failing services</td><td>Protect system resources when downstream service is down</td></tr><tr><td><strong>Timeout</strong></td><td>Limit operation duration</td><td>Prevent indefinite waits and resource exhaustion</td></tr><tr><td><strong>Fallback</strong></td><td>Provide alternative response when operation fails</td><td>Return cached data or default values</td></tr><tr><td><strong>Bulkhead Isolation</strong></td><td>Limit concurrent operations</td><td>Prevent resource exhaustion from too many parallel requests</td></tr></tbody></table><h3 id="policy-composition" tabindex="-1">Policy Composition <a class="header-anchor" href="#policy-composition" aria-label="Permalink to &quot;Policy Composition&quot;">​</a></h3><p>Polly policies can be composed together using the <code>Wrap</code> method or by chaining multiple <code>AddPolicyHandler</code> calls. The BlackSlope.Api application demonstrates policy composition in the <code>FakeApiRepository</code> configuration, where multiple policies work together to provide comprehensive resilience.</p><p><strong>Policy Execution Order</strong>: When policies are chained, they execute in the order they are added, with each policy wrapping the next. For example:</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Retry → Circuit Breaker → Timeout → HTTP Request</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="retry-policies" tabindex="-1">Retry Policies <a class="header-anchor" href="#retry-policies" aria-label="Permalink to &quot;Retry Policies&quot;">​</a></h2><p>Retry policies automatically re-execute failed operations according to configured rules. The BlackSlope.Api application implements retry policies with exponential backoff for HTTP client operations.</p><h3 id="simple-retry" tabindex="-1">Simple Retry <a class="header-anchor" href="#simple-retry" aria-label="Permalink to &quot;Simple Retry&quot;">​</a></h3><p>A basic retry policy attempts the operation a fixed number of times with no delay between attempts:</p><div class="language-csharp vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">csharp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Simple retry - 3 attempts with no delay</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AddPolicyHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    HttpPolicyExtensions.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">HandleTransientHttpError</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">RetryAsync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>Note</strong>: Simple retries without delays can overwhelm already-stressed services and should generally be avoided in production scenarios.</p><h3 id="exponential-backoff" tabindex="-1">Exponential Backoff <a class="header-anchor" href="#exponential-backoff" aria-label="Permalink to &quot;Exponential Backoff&quot;">​</a></h3><p>The recommended approach is exponential backoff, which increases the delay between retry attempts exponentially. This gives failing services time to recover and reduces the load on downstream systems.</p><p>The <code>FakeApiRepository</code> demonstrates this pattern:</p><div class="language-csharp vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">csharp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">services.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AddHttpClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IFakeApiRepository</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FakeApiRepository</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">SetHandlerLifetime</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(TimeSpan.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FromMinutes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 3 min request lifecycle</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AddPolicyHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">_</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // Retry x3 w/ Exponential Backoff</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        HttpPolicyExtensions.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">HandleTransientHttpError</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">OrResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> msg.StatusCode </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> System.Net.HttpStatusCode.NotFound)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">WaitAndRetryAsync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">retryAttempt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            TimeSpan.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FromSeconds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Math.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Pow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, retryAttempt))));</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>Breakdown of the Configuration</strong>:</p><ol><li><strong><code>HandleTransientHttpError()</code></strong>: Handles HTTP 5xx errors and <code>HttpRequestException</code> (network failures)</li><li><strong><code>OrResult(msg =&gt; msg.StatusCode == System.Net.HttpStatusCode.NotFound)</code></strong>: Additionally treats HTTP 404 responses as retriable errors</li><li><strong><code>WaitAndRetryAsync(2, ...)</code></strong>: Performs 2 retry attempts (3 total attempts including the initial request)</li><li><strong><code>TimeSpan.FromSeconds(Math.Pow(2, retryAttempt))</code></strong>: Calculates exponential backoff delays: <ul><li>1st retry: 2^1 = 2 seconds</li><li>2nd retry: 2^2 = 4 seconds</li></ul></li></ol><h3 id="retry-configuration-best-practices" tabindex="-1">Retry Configuration Best Practices <a class="header-anchor" href="#retry-configuration-best-practices" aria-label="Permalink to &quot;Retry Configuration Best Practices&quot;">​</a></h3><p><strong>Determining Retry Count</strong>:</p><ul><li><strong>Low retry counts (1-3)</strong>: Suitable for most scenarios; prevents excessive delays</li><li><strong>Higher retry counts (4-6)</strong>: Use only when operations are idempotent and delays are acceptable</li><li><strong>Consider total time</strong>: With exponential backoff, delays grow quickly (2s, 4s, 8s, 16s, etc.)</li></ul><p><strong>Handling Specific Status Codes</strong>:</p><div class="language-csharp vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">csharp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">OrResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    msg.StatusCode </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> System.Net.HttpStatusCode.RequestTimeout </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    msg.StatusCode </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> System.Net.HttpStatusCode.ServiceUnavailable </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    msg.StatusCode </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">System</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Net</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">HttpStatusCode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">429</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Too Many Requests</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>Adding Jitter</strong>: To prevent &quot;retry storms&quot; where multiple clients retry simultaneously, add randomization:</p><div class="language-csharp vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">csharp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">WaitAndRetryAsync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">retryAttempt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    TimeSpan.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FromSeconds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Math.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Pow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, retryAttempt)) </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> TimeSpan.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FromMilliseconds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Random</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Next</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)))</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="circuit-breaker" tabindex="-1">Circuit Breaker <a class="header-anchor" href="#circuit-breaker" aria-label="Permalink to &quot;Circuit Breaker&quot;">​</a></h2><p>The Circuit Breaker pattern prevents an application from repeatedly attempting operations that are likely to fail, allowing the system to recover and preventing cascading failures.</p><h3 id="circuit-breaker-pattern" tabindex="-1">Circuit Breaker Pattern <a class="header-anchor" href="#circuit-breaker-pattern" aria-label="Permalink to &quot;Circuit Breaker Pattern&quot;">​</a></h3><p>The circuit breaker operates in three states:</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌─────────┐  Failure threshold exceeded  ┌──────┐</span></span>
<span class="line"><span>│ Closed  │─────────────────────────────&gt;│ Open │</span></span>
<span class="line"><span>│(Normal) │                               │(Fast│</span></span>
<span class="line"><span>└─────────┘                               │Fail)│</span></span>
<span class="line"><span>     ^                                    └──────┘</span></span>
<span class="line"><span>     │                                       │</span></span>
<span class="line"><span>     │                                       │ Timeout expires</span></span>
<span class="line"><span>     │                                       v</span></span>
<span class="line"><span>     │                                    ┌──────────┐</span></span>
<span class="line"><span>     │  Success threshold met             │Half-Open │</span></span>
<span class="line"><span>     └────────────────────────────────────│(Testing) │</span></span>
<span class="line"><span>                                          └──────────┘</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><strong>State Descriptions</strong>:</p><table tabindex="0"><thead><tr><th>State</th><th>Behavior</th><th>Transition Condition</th></tr></thead><tbody><tr><td><strong>Closed</strong></td><td>Requests pass through normally; failures are counted</td><td>After N consecutive failures or X% failure rate, transition to Open</td></tr><tr><td><strong>Open</strong></td><td>All requests fail immediately without attempting the operation</td><td>After timeout period, transition to Half-Open</td></tr><tr><td><strong>Half-Open</strong></td><td>Limited number of test requests are allowed through</td><td>If test requests succeed, transition to Closed; if they fail, return to Open</td></tr></tbody></table><h3 id="state-transitions" tabindex="-1">State Transitions <a class="header-anchor" href="#state-transitions" aria-label="Permalink to &quot;State Transitions&quot;">​</a></h3><p><strong>Example Circuit Breaker Configuration</strong>:</p><div class="language-csharp vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">csharp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">services.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AddHttpClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IFakeApiRepository</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FakeApiRepository</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AddPolicyHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        HttpPolicyExtensions.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">HandleTransientHttpError</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">CircuitBreakerAsync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                handledEventsAllowedBeforeBreaking</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Open after 5 consecutive failures</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                durationOfBreak</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: TimeSpan.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FromSeconds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">30</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Stay open for 30 seconds</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    );</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>State Transition Example</strong>:</p><ol><li><strong>Closed State</strong>: Service is healthy, requests succeed</li><li><strong>Failure Accumulation</strong>: 5 consecutive requests fail (network timeout, 500 errors, etc.)</li><li><strong>Open State</strong>: Circuit opens, all requests fail immediately with <code>BrokenCircuitException</code></li><li><strong>Recovery Period</strong>: After 30 seconds, circuit transitions to Half-Open</li><li><strong>Test Request</strong>: Next request is allowed through to test service health</li><li><strong>Success</strong>: If test succeeds, circuit closes and normal operation resumes</li><li><strong>Failure</strong>: If test fails, circuit reopens for another 30 seconds</li></ol><h3 id="configuration" tabindex="-1">Configuration <a class="header-anchor" href="#configuration" aria-label="Permalink to &quot;Configuration&quot;">​</a></h3><p><strong>Advanced Circuit Breaker with Retry</strong>:</p><div class="language-csharp vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">csharp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Define circuit breaker policy</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> circuitBreakerPolicy</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> HttpPolicyExtensions</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">HandleTransientHttpError</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">CircuitBreakerAsync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        handledEventsAllowedBeforeBreaking</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        durationOfBreak</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: TimeSpan.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FromSeconds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">30</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        onBreak</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">outcome</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">timespan</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // Log circuit breaker opening</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            Console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">WriteLine</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">$&quot;Circuit breaker opened for {</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">timespan</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">TotalSeconds</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}s&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        },</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        onReset</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // Log circuit breaker closing</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            Console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">WriteLine</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Circuit breaker reset&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        },</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        onHalfOpen</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // Log circuit breaker testing</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            Console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">WriteLine</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Circuit breaker half-open, testing service&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    );</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Define retry policy</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> retryPolicy</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> HttpPolicyExtensions</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">HandleTransientHttpError</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">WaitAndRetryAsync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">retryAttempt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        TimeSpan.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FromSeconds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Math.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Pow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, retryAttempt)));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Combine policies: Retry wraps Circuit Breaker</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">services.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AddHttpClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IFakeApiRepository</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FakeApiRepository</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AddPolicyHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(retryPolicy)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AddPolicyHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(circuitBreakerPolicy);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p><strong>Important Considerations</strong>:</p><ul><li><strong>Policy Order Matters</strong>: Place retry policy before circuit breaker to retry before breaking the circuit</li><li><strong>Shared vs. Instance Policies</strong>: Circuit breaker state is shared across all requests using the same policy instance</li><li><strong>Monitoring</strong>: Implement logging in <code>onBreak</code>, <code>onReset</code>, and <code>onHalfOpen</code> callbacks for observability</li><li><strong>Failure Threshold</strong>: Set <code>handledEventsAllowedBeforeBreaking</code> based on expected failure rates and service SLAs</li></ul><h2 id="timeout-policies" tabindex="-1">Timeout Policies <a class="header-anchor" href="#timeout-policies" aria-label="Permalink to &quot;Timeout Policies&quot;">​</a></h2><p>Timeout policies prevent operations from running indefinitely, protecting system resources and providing predictable response times.</p><h3 id="optimistic-timeouts" tabindex="-1">Optimistic Timeouts <a class="header-anchor" href="#optimistic-timeouts" aria-label="Permalink to &quot;Optimistic Timeouts&quot;">​</a></h3><p>Optimistic timeouts allow the operation to complete but cancel the <code>CancellationToken</code> after the timeout period. The operation may continue in the background but the caller receives a timeout exception.</p><div class="language-csharp vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">csharp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">services.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AddHttpClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IFakeApiRepository</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FakeApiRepository</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AddPolicyHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Policy.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TimeoutAsync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">HttpResponseMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;(</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        timeout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: TimeSpan.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FromSeconds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        timeoutStrategy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: TimeoutStrategy.Optimistic</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ));</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>Characteristics</strong>:</p><ul><li><strong>Cooperative Cancellation</strong>: Relies on the operation respecting the <code>CancellationToken</code></li><li><strong>Lower Overhead</strong>: Doesn&#39;t create additional threads</li><li><strong>Best For</strong>: Operations that properly handle cancellation tokens</li></ul><p><strong>Gotcha</strong>: If the underlying operation doesn&#39;t respect cancellation tokens, it will continue consuming resources even after timeout.</p><h3 id="pessimistic-timeouts" tabindex="-1">Pessimistic Timeouts <a class="header-anchor" href="#pessimistic-timeouts" aria-label="Permalink to &quot;Pessimistic Timeouts&quot;">​</a></h3><p>Pessimistic timeouts forcefully terminate the operation by abandoning the task after the timeout period, regardless of whether it respects cancellation.</p><div class="language-csharp vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">csharp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">services.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AddHttpClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IFakeApiRepository</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FakeApiRepository</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AddPolicyHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Policy.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TimeoutAsync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">HttpResponseMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;(</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        timeout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: TimeSpan.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FromSeconds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        timeoutStrategy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: TimeoutStrategy.Pessimistic</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ));</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>Characteristics</strong>:</p><ul><li><strong>Forceful Termination</strong>: Abandons the task after timeout</li><li><strong>Higher Overhead</strong>: May create additional threads for monitoring</li><li><strong>Best For</strong>: Operations that may not respect cancellation tokens</li></ul><p><strong>Warning</strong>: Abandoned tasks continue to consume resources until they complete or fail. Use pessimistic timeouts sparingly.</p><h3 id="timeout-configuration-best-practices" tabindex="-1">Timeout Configuration Best Practices <a class="header-anchor" href="#timeout-configuration-best-practices" aria-label="Permalink to &quot;Timeout Configuration Best Practices&quot;">​</a></h3><p><strong>Combining Timeout with Retry</strong>:</p><div class="language-csharp vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">csharp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Per-request timeout</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> timeoutPolicy</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Policy.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TimeoutAsync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">HttpResponseMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    TimeSpan.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FromSeconds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Retry with exponential backoff</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> retryPolicy</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> HttpPolicyExtensions</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">HandleTransientHttpError</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Or</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TimeoutRejectedException</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;() </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Handle timeout exceptions</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">WaitAndRetryAsync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">retryAttempt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        TimeSpan.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FromSeconds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Math.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Pow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, retryAttempt)));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Overall timeout for all retries</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> overallTimeoutPolicy</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Policy.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TimeoutAsync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">HttpResponseMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    TimeSpan.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FromSeconds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">30</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Apply policies: Overall Timeout → Retry → Per-Request Timeout</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">services.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AddHttpClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IFakeApiRepository</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FakeApiRepository</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AddPolicyHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(overallTimeoutPolicy)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AddPolicyHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(retryPolicy)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AddPolicyHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(timeoutPolicy);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p><strong>Timeout Values</strong>:</p><ul><li><strong>Per-Request Timeout</strong>: Should be slightly longer than expected response time (e.g., 10s for 5s average)</li><li><strong>Overall Timeout</strong>: Should account for all retries and delays (e.g., 30s for 3 retries with exponential backoff)</li><li><strong>Handler Lifetime</strong>: Set via <code>SetHandlerLifetime()</code> to control connection pooling (default: 2 minutes)</li></ul><h2 id="testing-resilience" tabindex="-1">Testing Resilience <a class="header-anchor" href="#testing-resilience" aria-label="Permalink to &quot;Testing Resilience&quot;">​</a></h2><p>The BlackSlope.Api application provides a dedicated endpoint for testing Polly resilience policies in action.</p><h3 id="exponential-backoff-endpoint" tabindex="-1">Exponential Backoff Endpoint <a class="header-anchor" href="#exponential-backoff-endpoint" aria-label="Permalink to &quot;Exponential Backoff Endpoint&quot;">​</a></h3><p>The <code>MoviesController</code> includes a test endpoint that demonstrates the exponential backoff retry policy:</p><div class="language-csharp vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">csharp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/// &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">summary</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/// Invoke Http Test with Polly Exponential Backoff</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/// &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">summary</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/// &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">response</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> code</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;200&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">&gt;Success.&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">response</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/// &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">response</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> code</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;400&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">&gt;Bad Request&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">response</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/// &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">response</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> code</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;401&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">&gt;Unauthorized&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">response</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/// &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">response</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> code</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;500&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">&gt;Internal Server Error&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">response</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ProducesResponseType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(StatusCodes.Status200OK)]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ProducesResponseType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(StatusCodes.Status400BadRequest)]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ProducesResponseType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(StatusCodes.Status401Unauthorized)]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ProducesResponseType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(StatusCodes.Status500InternalServerError)]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">HttpGet</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Route</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;api/v1/movies/httpExponentialBackoffTest&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> async</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Task</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ActionResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">GetExponentialBackoff</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _movieService.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">GetExponentialBackoff</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 200 response</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HandleSuccessResponse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p><strong>Testing the Endpoint</strong>:</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Test exponential backoff behavior</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -X</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> GET</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;https://localhost:51385/api/v1/movies/httpExponentialBackoffTest&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;accept: */*&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="simulating-failures" tabindex="-1">Simulating Failures <a class="header-anchor" href="#simulating-failures" aria-label="Permalink to &quot;Simulating Failures&quot;">​</a></h3><p>To effectively test resilience policies, you need to simulate various failure scenarios:</p><p><strong>1. Network Failures</strong>:</p><div class="language-csharp vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">csharp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// In your test repository, throw HttpRequestException</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> async</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Task</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">GetDataAsync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    throw</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HttpRequestException</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Simulated network failure&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>2. HTTP Error Responses</strong>:</p><div class="language-csharp vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">csharp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Return specific status codes</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HttpResponseMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(HttpStatusCode.ServiceUnavailable)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Content </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> StringContent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Service temporarily unavailable&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>3. Timeouts</strong>:</p><div class="language-csharp vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">csharp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Simulate slow response</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Task.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Delay</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(TimeSpan.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FromSeconds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">15</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HttpResponseMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(HttpStatusCode.OK);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>4. Intermittent Failures</strong>:</p><div class="language-csharp vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">csharp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> _requestCount</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> async</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Task</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">HttpResponseMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">GetDataAsync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    _requestCount</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Fail first 2 requests, succeed on 3rd</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (_requestCount </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        throw</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HttpRequestException</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Simulated failure&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HttpResponseMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(HttpStatusCode.OK);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="verifying-policies" tabindex="-1">Verifying Policies <a class="header-anchor" href="#verifying-policies" aria-label="Permalink to &quot;Verifying Policies&quot;">​</a></h3><p><strong>Logging Retry Attempts</strong>:</p><div class="language-csharp vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">csharp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">services.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AddHttpClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IFakeApiRepository</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FakeApiRepository</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AddPolicyHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">services</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        HttpPolicyExtensions.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">HandleTransientHttpError</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">WaitAndRetryAsync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                retryCount</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                sleepDurationProvider</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">retryAttempt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    TimeSpan.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FromSeconds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Math.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Pow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, retryAttempt)),</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                onRetry</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">outcome</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">timespan</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">retryCount</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                    var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> logger</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> services.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">GetService</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ILogger</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FakeApiRepository</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;&gt;();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    logger.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">LogWarning</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                        &quot;Retry {RetryCount} after {Delay}ms due to {Exception}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                        retryCount,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                        timespan.TotalMilliseconds,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                        outcome.Exception</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.Message </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">??</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> outcome.Result</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.StatusCode.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ToString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    );</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p><strong>Integration Test Example</strong>:</p><div class="language-csharp vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">csharp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Fact</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> async</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Task</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> GetExponentialBackoff_WithTransientFailures_RetriesAndSucceeds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Arrange</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> mockHandler</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MockHttpMessageHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    mockHandler.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">SetupSequence</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ReturnsResponse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(HttpStatusCode.ServiceUnavailable) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 1st attempt fails</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ReturnsResponse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(HttpStatusCode.ServiceUnavailable) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 2nd attempt fails</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ReturnsResponse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(HttpStatusCode.OK);                </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 3rd attempt succeeds</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> httpClient</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HttpClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(mockHandler);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> repository</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> FakeApiRepository</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(httpClient);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Act</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> result</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> repository.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">GetDataAsync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Assert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Assert.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NotNull</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(result);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Assert.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Equal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, mockHandler.RequestCount); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Verify 3 attempts were made</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p><strong>Monitoring in Production</strong>:</p><p>For production environments, integrate with Application Insights or similar monitoring tools:</p><div class="language-csharp vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">csharp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AddPolicyHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">services</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> telemetryClient</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> services.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">GetService</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TelemetryClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> HttpPolicyExtensions.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">HandleTransientHttpError</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">WaitAndRetryAsync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            retryCount</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            sleepDurationProvider</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">retryAttempt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                TimeSpan.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FromSeconds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Math.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Pow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, retryAttempt)),</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            onRetry</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">outcome</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">timespan</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">retryCount</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                telemetryClient</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TrackEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;HttpRetry&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Dictionary</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;RetryCount&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> retryCount.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ToString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Delay&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> timespan.TotalMilliseconds.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ToString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Endpoint&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> request.RequestUri</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ToString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;StatusCode&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> outcome.Result</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.StatusCode.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ToString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h2 id="integration-with-httpclientfactory" tabindex="-1">Integration with HttpClientFactory <a class="header-anchor" href="#integration-with-httpclientfactory" aria-label="Permalink to &quot;Integration with HttpClientFactory&quot;">​</a></h2><p>The BlackSlope.Api application leverages ASP.NET Core&#39;s <code>HttpClientFactory</code> for managing <code>HttpClient</code> instances with Polly policies. This integration is configured in <code>Startup.cs</code>:</p><div class="language-csharp vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">csharp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">services.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AddTransient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IHttpClientDecorator</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">HttpClientDecorator</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">services.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AddHttpClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;movies&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">provider</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">client</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    provider.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">GetRequiredService</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IHttpClientDecorator</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Configure</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(client));</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>Benefits of HttpClientFactory Integration</strong>:</p><ol><li><strong>Automatic Lifetime Management</strong>: Prevents socket exhaustion by properly managing <code>HttpClient</code> lifetimes</li><li><strong>Policy Reuse</strong>: Polly policies are applied consistently across all requests</li><li><strong>Dependency Injection</strong>: Typed clients can be injected with policies pre-configured</li><li><strong>Handler Pipeline</strong>: Allows composition of multiple delegating handlers</li></ol><p><strong>Handler Lifetime Configuration</strong>:</p><div class="language-csharp vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">csharp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">services.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AddHttpClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IFakeApiRepository</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FakeApiRepository</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">SetHandlerLifetime</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(TimeSpan.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FromMinutes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Recycle handlers every 3 minutes</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>The default handler lifetime is 2 minutes. Adjust based on:</p><ul><li><strong>DNS changes</strong>: Shorter lifetimes ensure DNS changes are picked up</li><li><strong>Connection pooling</strong>: Longer lifetimes improve performance by reusing connections</li><li><strong>Memory usage</strong>: Shorter lifetimes reduce memory footprint</li></ul><h2 id="related-documentation" tabindex="-1">Related Documentation <a class="header-anchor" href="#related-documentation" aria-label="Permalink to &quot;Related Documentation&quot;">​</a></h2><p>For additional information on related topics, see:</p><ul><li><a href="/features/http_client.html">HTTP Client Configuration</a> - Detailed HttpClient setup and configuration</li><li><a href="/testing/integration_tests.html">Integration Tests</a> - Testing strategies for resilience policies</li><li><a href="/deployment/production_best_practices.html">Production Best Practices</a> - Deployment considerations for resilient applications</li></ul><h2 id="summary" tabindex="-1">Summary <a class="header-anchor" href="#summary" aria-label="Permalink to &quot;Summary&quot;">​</a></h2><p>Polly provides comprehensive resilience capabilities for the BlackSlope.Api application:</p><ul><li><strong>Retry policies</strong> with exponential backoff handle transient failures gracefully</li><li><strong>Circuit breakers</strong> prevent cascading failures and allow systems to recover</li><li><strong>Timeout policies</strong> protect resources and provide predictable response times</li><li><strong>Policy composition</strong> enables sophisticated fault-handling strategies</li><li><strong>HttpClientFactory integration</strong> ensures consistent policy application across all HTTP requests</li></ul><p>By implementing these patterns, the BlackSlope.Api application maintains high availability and gracefully handles the inevitable failures that occur in distributed systems.</p></div></div></main><footer class="VPDocFooter" data-v-2e62732c data-v-6db614b6><!--[--><!--]--><!----><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-6db614b6><span class="visually-hidden" id="doc-footer-aria-label" data-v-6db614b6>Pager</span><div class="pager" data-v-6db614b6><a class="VPLink link pager-link prev" href="/features/correlation_id.html" data-v-6db614b6><!--[--><span class="desc" data-v-6db614b6>Previous page</span><span class="title" data-v-6db614b6>Correlation ID</span><!--]--></a></div><div class="pager" data-v-6db614b6><a class="VPLink link pager-link next" href="/features/http_client.html" data-v-6db614b6><!--[--><span class="desc" data-v-6db614b6>Next page</span><span class="title" data-v-6db614b6>HTTP Client</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-08477083 data-v-3d8f0d8a><div class="container" data-v-3d8f0d8a><!----><p class="copyright" data-v-3d8f0d8a>© Slalom, Inc. All rights reserved. Auto-generated by GenAI via TaskStream. Always verify for accuracy.</p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"api_reference_error_responses.md\":\"843tro5z\",\"api_reference_health_api.md\":\"C3awUm82\",\"api_reference_movies_api.md\":\"DG2K85Q5\",\"api_reference_version_api.md\":\"CgqWeSmp\",\"architecture_dependency_injection.md\":\"DlMJNq_K\",\"architecture_layers.md\":\"DPrsBoZk\",\"architecture_middleware_pipeline.md\":\"y6XD6OCp\",\"architecture_overview.md\":\"B1gsAp_v\",\"architecture_project_structure.md\":\"0lgK2T8L\",\"configuration_application_settings.md\":\"C-pr1iqk\",\"configuration_logging.md\":\"DjuGhHjq\",\"configuration_service_configuration.md\":\"CH850BxE\",\"database_entity_framework.md\":\"D5aKwhys\",\"database_migrations.md\":\"DbSJf2xQ\",\"database_repository_configuration.md\":\"BoQLUIdw\",\"database_seeding_data.md\":\"Ckn7WcYS\",\"deployment_docker.md\":\"ZrVcYN9f\",\"deployment_kubernetes.md\":\"CvdpTl5B\",\"deployment_monitoring.md\":\"BAuinbxR\",\"deployment_production_best_practices.md\":\"BAZCGOPq\",\"deployment_versioning_strategy.md\":\"DJv6WMwt\",\"development_build_scripts.md\":\"C72SgFnJ\",\"development_code_quality.md\":\"CC7gxywF\",\"development_contributing.md\":\"Beg1vDiC\",\"development_environment.md\":\"BK2zZm1p\",\"development_utilities.md\":\"D6ixHDsw\",\"features_automapper.md\":\"CLCnXnpd\",\"features_controllers.md\":\"DYHOFksW\",\"features_correlation_id.md\":\"DWrxzZ5U\",\"features_exception_handling.md\":\"hpuN8Wru\",\"features_health_checks.md\":\"CcylugK3\",\"features_http_client.md\":\"B7Vq8mjh\",\"features_repositories.md\":\"DnK0o2W8\",\"features_resilience.md\":\"DkWVoTdz\",\"features_services.md\":\"CQ3W7wbk\",\"features_swagger_integration.md\":\"DT3fT0cv\",\"features_validation.md\":\"BUPRAoTL\",\"features_versioning.md\":\"DZ_TTBY2\",\"getting_started_installation.md\":\"DLlWNBIk\",\"getting_started_introduction.md\":\"DlCGfMpJ\",\"getting_started_prerequisites.md\":\"CoKU8q2w\",\"getting_started_quick_start.md\":\"CM3DTCbd\",\"index.md\":\"C4kPoYsN\",\"security_authentication.md\":\"5vH38omZ\",\"security_authorization.md\":\"DJZx_v86\",\"security_best_practices.md\":\"zXkczA1u\",\"security_cors.md\":\"k-xntvrj\",\"testing_bdd_tests.md\":\"DiKGffhq\",\"testing_integration_tests.md\":\"DkR4kXtW\",\"testing_overview.md\":\"BEFCfo0s\",\"testing_test_utilities.md\":\"DPgXn6x6\",\"testing_unit_tests.md\":\"BbMUWHu6\",\"troubleshooting_common_issues.md\":\"DIzUiadW\",\"troubleshooting_debugging.md\":\"B6ovc0FH\",\"troubleshooting_faq.md\":\"B52OP08j\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"BlackSlope.NET Documentation\",\"titleTemplate\":\":title - BlackSlope.NET\",\"description\":\"Documentation for BlackSlope.NET - A .NET Reference Architecture\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"Home\",\"link\":\"/\"},{\"text\":\"Getting Started\",\"link\":\"/getting_started/introduction\"},{\"text\":\"Architecture\",\"link\":\"/architecture/overview\"},{\"text\":\"API Reference\",\"link\":\"/api_reference/health_api\"}],\"sidebar\":[{\"text\":\"Getting Started\",\"items\":[{\"text\":\"Introduction\",\"link\":\"/getting_started/introduction\"},{\"text\":\"Prerequisites\",\"link\":\"/getting_started/prerequisites\"},{\"text\":\"Installation\",\"link\":\"/getting_started/installation\"},{\"text\":\"Quick Start\",\"link\":\"/getting_started/quick_start\"}]},{\"text\":\"Architecture\",\"items\":[{\"text\":\"Overview\",\"link\":\"/architecture/overview\"},{\"text\":\"Project Structure\",\"link\":\"/architecture/project_structure\"},{\"text\":\"Layers\",\"link\":\"/architecture/layers\"},{\"text\":\"Dependency Injection\",\"link\":\"/architecture/dependency_injection\"},{\"text\":\"Middleware Pipeline\",\"link\":\"/architecture/middleware_pipeline\"}]},{\"text\":\"Features\",\"items\":[{\"text\":\"Controllers\",\"link\":\"/features/controllers\"},{\"text\":\"Services\",\"link\":\"/features/services\"},{\"text\":\"Repositories\",\"link\":\"/features/repositories\"},{\"text\":\"AutoMapper\",\"link\":\"/features/automapper\"},{\"text\":\"Validation\",\"link\":\"/features/validation\"},{\"text\":\"Exception Handling\",\"link\":\"/features/exception_handling\"},{\"text\":\"Health Checks\",\"link\":\"/features/health_checks\"},{\"text\":\"Swagger Integration\",\"link\":\"/features/swagger_integration\"},{\"text\":\"Versioning\",\"link\":\"/features/versioning\"},{\"text\":\"Correlation ID\",\"link\":\"/features/correlation_id\"},{\"text\":\"Resilience (Polly)\",\"link\":\"/features/resilience\"},{\"text\":\"HTTP Client\",\"link\":\"/features/http_client\"}]},{\"text\":\"Database\",\"items\":[{\"text\":\"Entity Framework\",\"link\":\"/database/entity_framework\"},{\"text\":\"Migrations\",\"link\":\"/database/migrations\"},{\"text\":\"Repository Configuration\",\"link\":\"/database/repository_configuration\"},{\"text\":\"Seeding Data\",\"link\":\"/database/seeding_data\"}]},{\"text\":\"Configuration\",\"items\":[{\"text\":\"Application Settings\",\"link\":\"/configuration/application_settings\"},{\"text\":\"Service Configuration\",\"link\":\"/configuration/service_configuration\"},{\"text\":\"Logging\",\"link\":\"/configuration/logging\"}]},{\"text\":\"Security\",\"items\":[{\"text\":\"Authentication\",\"link\":\"/security/authentication\"},{\"text\":\"Authorization\",\"link\":\"/security/authorization\"},{\"text\":\"CORS\",\"link\":\"/security/cors\"},{\"text\":\"Best Practices\",\"link\":\"/security/best_practices\"}]},{\"text\":\"API Reference\",\"items\":[{\"text\":\"Movies API\",\"link\":\"/api_reference/movies_api\"},{\"text\":\"Health API\",\"link\":\"/api_reference/health_api\"},{\"text\":\"Version API\",\"link\":\"/api_reference/version_api\"},{\"text\":\"Error Responses\",\"link\":\"/api_reference/error_responses\"}]},{\"text\":\"Testing\",\"items\":[{\"text\":\"Overview\",\"link\":\"/testing/overview\"},{\"text\":\"Unit Tests\",\"link\":\"/testing/unit_tests\"},{\"text\":\"Integration Tests\",\"link\":\"/testing/integration_tests\"},{\"text\":\"BDD Tests\",\"link\":\"/testing/bdd_tests\"},{\"text\":\"Test Utilities\",\"link\":\"/testing/test_utilities\"}]},{\"text\":\"Development\",\"items\":[{\"text\":\"Environment Setup\",\"link\":\"/development/environment\"},{\"text\":\"Build Scripts\",\"link\":\"/development/build_scripts\"},{\"text\":\"Code Quality\",\"link\":\"/development/code_quality\"},{\"text\":\"Utilities\",\"link\":\"/development/utilities\"},{\"text\":\"Contributing\",\"link\":\"/development/contributing\"}]},{\"text\":\"Deployment\",\"items\":[{\"text\":\"Docker\",\"link\":\"/deployment/docker\"},{\"text\":\"Kubernetes\",\"link\":\"/deployment/kubernetes\"},{\"text\":\"Monitoring\",\"link\":\"/deployment/monitoring\"},{\"text\":\"Versioning Strategy\",\"link\":\"/deployment/versioning_strategy\"},{\"text\":\"Production Best Practices\",\"link\":\"/deployment/production_best_practices\"}]},{\"text\":\"Troubleshooting\",\"items\":[{\"text\":\"Common Issues\",\"link\":\"/troubleshooting/common_issues\"},{\"text\":\"Debugging\",\"link\":\"/troubleshooting/debugging\"},{\"text\":\"FAQ\",\"link\":\"/troubleshooting/faq\"}]}],\"search\":{\"provider\":\"local\"},\"footer\":{\"message\":\"\",\"copyright\":\"© Slalom, Inc. All rights reserved. Auto-generated by GenAI via TaskStream. Always verify for accuracy.\"},\"externalLinkIcon\":true,\"outline\":{\"level\":\"deep\",\"label\":\"Contents\"}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>